<div
  class="w-full flex flex-col overflow-hidden lg:flex-1 lg:max-w-[480px] h-full bg-custom-surface2 border-t lg:border-t-0 lg:border-l border-custom-border">
  <div
    class="py-2 sm:py-[9px] px-3 sm:px-4 bg-custom-surface border-b border-custom-border text-[9px] sm:text-[10px] font-medium tracking-[1.2px] sm:tracking-[1.5px] text-custom-text-dim uppercase flex-shrink-0 flex items-center gap-1.5 sm:gap-2">
    <span
      class="w-1 h-1 sm:w-1.5 sm:h-1.5 rounded-full bg-custom-accent3 shadow-[0_0_6px_#ff6b35]"></span>
    <span class="hidden sm:inline">SEGMENT DETAIL</span>
    <span class="sm:hidden">DETAIL</span>
  </div>

  <div class="flex-1 overflow-y-auto scrollbar-thin">
    <!-- Empty state -->
    @if (showEmptyState) {
      <div
        class="flex flex-col items-center justify-center gap-2 sm:gap-2.5 text-custom-text-dim text-[10px] sm:text-[11px] leading-6 sm:leading-8 text-center py-6 sm:py-10 px-6 sm:px-10 h-full">
        <div class="text-[32px] sm:text-[40px] opacity-20">◈</div>
        Paste a message on the left,<br />then click any segment line
      </div>
    }

    <!-- Invalid segment state -->
    @if (showInvalidState) {
      <div
        class="flex flex-col items-center justify-center gap-2.5 text-custom-text-dim text-[11px] leading-8 text-center py-10 px-10 h-full">
        <div class="text-[40px] opacity-20">◈</div>
        Line {{ lineIndex + 1 }} is not a valid HL7 segment.<br />Segments start
        with a 3-char code followed by <code class="text-custom-accent">|</code>
      </div>
    }

    <!-- Segment details -->
    @if (!showEmptyState && !showInvalidState) {
      <div>
        <div
          class="py-[13px] px-5 border-b border-custom-border bg-custom-surface flex items-start justify-between">
          <div>
            <div
              class="font-syne text-[21px] font-extrabold text-custom-text-bright">
              <span class="text-custom-accent">{{ segmentName }}</span>
            </div>
            <div class="text-[11px] text-custom-text-dim mt-0.5">
              {{ segmentDescription }}
            </div>
          </div>
          <div
            class="text-[10px] text-custom-text-dim py-[3px] px-2 bg-custom-surface2 border border-custom-border rounded-[2px] whitespace-nowrap">
            Line {{ lineIndex + 1 }}
          </div>
        </div>
        <div class="p-4">
          @for (field of fields; track field; let fi = $index) {
            <div>
              <!-- Composite field -->
              @if (field.components) {
                <div class="mb-4 pb-4 border-b border-custom-border">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="text-[9px] text-custom-text-dim">{{
                      field.fieldNumber
                    }}</span>
                    <span class="text-[10px] text-custom-accent2 font-medium">{{
                      field.fieldName
                    }}</span>
                  </div>
                  <div class="flex flex-col gap-2 ml-4">
                    @for (
                      component of field.components;
                      track component;
                      let ci = $index
                    ) {
                      <div class="floating-label-container relative">
                        <input
                          type="text"
                          class="floating-label-input"
                          [class.pr-2]="component.isDate"
                          [value]="component.value"
                          (input)="onFieldValueChange(fi, ci, getValue($event))"
                          [id]="'field-' + lineIndex + '-' + fi + '-' + ci" />
                        <label
                          class="floating-label"
                          [for]="'field-' + lineIndex + '-' + fi + '-' + ci">
                          {{ component.label }}
                        </label>
                        @if (component.isDate && component.value) {
                          <span class="date-preview">
                            {{ formatDate(component.value) }}
                          </span>
                        }
                      </div>
                    }
                  </div>
                </div>
              }
              <!-- Simple field -->
              @if (!field.components) {
                <div class="mb-3">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="text-[9px] text-custom-text-dim">{{
                      field.fieldNumber
                    }}</span>
                  </div>
                  <div class="floating-label-container relative">
                    <input
                      type="text"
                      class="floating-label-input"
                      [class.text-custom-border]="field.isEmpty"
                      [class.italic]="field.isEmpty"
                      [class.pr-2]="field.isDate"
                      [value]="field.value"
                      [placeholder]="field.isEmpty ? '—' : ''"
                      (input)="onFieldValueChange(fi, null, getValue($event))"
                      [id]="'field-' + lineIndex + '-' + fi" />
                    <label
                      class="floating-label"
                      [for]="'field-' + lineIndex + '-' + fi">
                      {{ field.fieldName }}
                    </label>
                    @if (field.isDate && !field.isEmpty && field.value) {
                      <span class="date-preview">
                        {{ formatDate(field.value) }}
                      </span>
                    }
                  </div>
                </div>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>
</div>
